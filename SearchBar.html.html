<!DOCTYPE html>
<html>
<head>
    <style>
        /* Styles for the search input, including width, padding, and font size */
        #searchInput {
            width: 100%;
            padding: 8px;
            font-size: 16px;
            box-sizing: border-box;
        }

        /* Container style for the search suggestions, positioning it relative to the input */
        #suggestions-container {
            position: relative;
            width: 300px;
            margin: auto;
        }

        /* Style for the suggestions dropdown, including positioning, borders, and shadows */
        #suggestions {
            position: absolute;
            width: 100%;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-top: none;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
            display: none; /* Initially hidden */
            z-index: 1000;
            background: white;
            overflow-y: auto;
            max-height: 200px;
        }

        /* Styles for each suggestion within the dropdown */
        #suggestions div {
            padding: 8px;
            border-bottom: 1px solid #eee;
        }

        /* Styles for a suggestion when hovered over or highlighted */
        #suggestions div:hover, #suggestions div.highlighted {
            background-color: #DB92F0;
        }

        /* Style for the container showing the selected tree's details */
        #treeDetails {
            padding: 10px;
            margin-top: 20px;
        }

        /* Style for the tree image */
        .tree-image {
            width: 200px;
            height: auto;
        }
    </style>
</head>
<body onload="loadXMLDoc()">
    <h1 id="headerHTML">Search Bar Practice</h1>

    <!-- Container for the search bar and suggestions -->
    <div id="suggestions-container">
        <input type="text" id="searchInput" placeholder="Search..." autocomplete="off">
        <div id="suggestions"></div>
    </div>
    <!-- Container for displaying tree details -->
    <div id="treeDetails"></div>

    <script>
        // Array to store data about trees
        var treeData = [];
        // Variable to track the current selection index in the suggestions
        var currentSelectionIndex = -1;

        // Function to load data from an XML file
        function loadXMLDoc() {
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                    myParser(this);
                }
            };
            xhttp.open("GET", "1.xml", true);
            xhttp.send();
        }

        // Function to parse the XML and extract tree data
        function myParser(xml) {
            var xmlDoc = xml.responseXML;
            var items = xmlDoc.getElementsByTagName("ThemeEntityAbridgedData");

            for (var i = 0; i < items.length; i++) {
                var displayName = items[i].getElementsByTagName("DisplayName")[0].innerHTML;
                var entityId = items[i].getElementsByTagName("EntityId")[0].innerHTML;
                var imagePath = items[i].getElementsByTagName("DefaultImagePath")[0].innerHTML;
                
                treeData.push({
                    name: displayName,
                    id: entityId,
                    image: imagePath
                });
            }
        }

        // Event listener for the DOM content loaded event
        document.addEventListener('DOMContentLoaded', function() {
            var searchInput = document.getElementById('searchInput');
            // Event listener for input event on the search bar
            searchInput.addEventListener('input', function(event) {
                updateSuggestions(this.value);
            });

            // Event listener for keydown events to handle navigation and selection in the suggestions
            searchInput.addEventListener('keydown', function(event) {
                var suggestionsDiv = document.getElementById('suggestions');
                var suggestions = Array.from(suggestionsDiv.getElementsByTagName('div'));

                // Event handling for the Enter key
                if (event.key === "Enter") {
                    event.preventDefault(); // Prevent the form from being submitted

                    // Check if a suggestion is highlighted, then select it
                    if (currentSelectionIndex >= 0 && suggestions[currentSelectionIndex]) {
                        suggestions[currentSelectionIndex].click();
                    } else {
                        // If no suggestion is highlighted, check if the input matches a tree name
                        var exactMatch = treeData.find(function(tree) {
                            return tree.name.toLowerCase() === searchInput.value.toLowerCase();
                        });

                        // If there's an exact match, display its details
                        if (exactMatch) {
                            displayDetails(exactMatch);
                        }
                    }
                } else if (event.key === "ArrowDown" || event.key === "ArrowUp") {
                    // Handling arrow key navigation in the suggestions list
                    event.preventDefault(); // Prevent the default input behavior
                    var move = event.key === "ArrowDown" ? 1 : -1;
                    currentSelectionIndex = (currentSelectionIndex + move + suggestions.length) % suggestions.length;
                    highlightSelection(suggestions, currentSelectionIndex);
                }
            });
        });

        // Function to update the suggestions based on the input
        function updateSuggestions(input) {
            var filteredData = treeData.filter(function(tree) {
                return tree.name.toLowerCase().includes(input.toLowerCase());
            });

            displaySuggestions(filteredData);
        }

        // Function to display the suggestions
        function displaySuggestions(suggestions) {
            var suggestionsDiv = document.getElementById('suggestions');
            suggestionsDiv.innerHTML = '';

            suggestions.forEach(function(suggestion, index) {
                var div = document.createElement('div');
                div.textContent = suggestion.name;
                // Click event for each suggestion to display its details
                div.onclick = function() {
                    document.getElementById('searchInput').value = suggestion.name;
                    suggestionsDiv.style.display = 'none';
                    displayDetails(suggestion);
                };
                suggestionsDiv.appendChild(div);
            });

            suggestionsDiv.style.display = suggestions.length > 0 ? 'block' : 'none';
        }

        // Function to display the details of a selected tree
        function displayDetails(tree) {
            var detailsDiv = document.getElementById('treeDetails');
            detailsDiv.innerHTML = '';

            var nameElement = document.createElement('h3');
            nameElement.textContent = tree.name + " (ID: " + tree.id + ")";
            detailsDiv.appendChild(nameElement);

            // If the tree has an image, display it
            if (tree.image) {
                var imgElement = document.createElement('img');
                imgElement.src = tree.image;
                imgElement.alt = 'Image of ' + tree.name;
                imgElement.className = 'tree-image';
                detailsDiv.appendChild(imgElement);
            }
        }

        // Function to highlight the current selection in the suggestions list
        function highlightSelection(suggestions, index) {
            suggestions.forEach(function(suggestion, idx) {
                suggestion.classList.toggle('highlighted', index === idx);
            });
            // Scroll the highlighted suggestion into view
            if (suggestions[index]) {
                suggestions[index].scrollIntoView({ block: "nearest", behavior: "smooth" });
            }
        }
    </script>
</body>
</html>